<html>
<head>
        <!-- LOAD ADOBE TYPE KIT-->
        <script src="//use.typekit.net/pbn8riq.js"></script>
        <script>try{Typekit.load();}catch(e){}</script>
		        
        <!-- LOAD D3 LIBRARY -->
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <!--load auxillary scripts-->
		<script src="./states.js"></script>
		<script src="./clean.js"></script>

		<title>U.S. Vaccination Rates</title>
		
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
	
	
<body>


<div style="margin: 40px 0 0 50px; white-space: nowrap;">
    <div class="mapContainer">
    	<h4>Vaccination Across the U.S.</h4>
        <div id="map"></div>              
    </div>
</div>
<!-- MAP LEGEND -->
<div style="clear: both; white-space: nowrap;">
	<div style="display: inline-block; margin-right: 15px; font-weight: 600; font-size: .9em;">40%</div> 
	<div class="mapLegendGradient"></div>
    <div style="display: inline-block; margin-left: 15px; font-weight: 600; font-size: .9em;">100%</div>
</div>





<script>
d3.csv("tab02_antigen_iap_reduced.csv", function(d) {
	var overallData = cleanData(d);

d3.csv("tab10_wic_iap_reduced.csv", function(d) {
	var wicData = cleanData(d);

d3.csv("tab11_nowic_iap_reduced.csv", function(d) {
	var noWicData = cleanData(d);



var allRegionNames = d3.set();
overallData.forEach(function (row) {
	allRegionNames.add(row.Region);
});

console.log(overallData);

/**returns a single number corresponding to the vaccination rate
in the given region, year, and dataset for the given vaccine.
Returns empty string '' if no data available or not found. **/
var vaxRate = function(region, year, vaccine, dataset) {
	var correctRow = dataset.filter(function(row) {
		return row.Year == year && row.Region == region });
	try
		{ return correctRow[0][vaccine]; }
	catch(err)
		{ 	console.log('couldnt find vax rate for ' + region) 
			return ''; }
}


/*******CHOROPLETH*******/
	var mapWidth = 2000,
	    mapHeight = 500;
		
	var mapYear = 2013;
	var mapVaccine = '4+DTaP';


	var mapSvg = d3.select("#map")
	.append("svg")
    .attr("width", mapWidth)
    .attr("height", mapHeight);

	//color-scale
	var colorScale = d3.scale.linear().domain([60, 95]).range(['#fc8d59', '#91bfdb']);

	// albersUsa projection
	var projection = d3.geo.albersUsa();
	var path = d3.geo.path().projection(projection);
	

	d3.json("us-10m.json", function(error, shapes) {
		states = topojson.feature(shapes, shapes.objects.states).features;	

		var statePaths = mapSvg.append("g");

		console.log(states);

		statePaths.selectAll("path").data(states).enter()
		.append("path").attr("d", path)
		.attr("transform", "translate(-90, 0)")
		.style("fill", function (state) {
			var stateFips = state.id;
			var stateName = findName(stateFips);

			var stateVaxRate = vaxRate(stateName, mapYear, mapVaccine, overallData);
			
			if (stateVaxRate != '') {
				return colorScale(stateVaxRate);
			}
				else { return "gray"; }
		})
		.style("stroke", "#fff");

	})

	
}) }) })


</script>
</body>


</html>


